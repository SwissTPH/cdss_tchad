const {injectDataFromForm, isFormArrayHasSourceId} = require('./stph-extras');
const {getField} = require('./nools-extra');

const IMCI_FORMS = ['imci_interogation'];

const IMCI_CASE_DATA = [
    'p_sel_gender',
    'p_age',
    'p_weight',
    'p_weight_age',
    'p_weight_class',
    'd_convulsion',
    'd_convulsion_epi',
    'a_iv_possible',
    'a_ng_tube_possible_ds',
    'd_malnutrition_severe_complex',
    'd_malnutrition_severe_simple',
    'd_malnutrition_severe_possible',
    'd_malnutrition_moderate',
    'd_malnutrition_cannot_assess',
    'd_malnutrition_none',
    'd_malnutrition_severe',
    'd_ictere',
    'd_anemia_moderate_to_test',
    'd_anemia_severe_to_test',
    'd_anemia_severe_possible',
    'd_anemia_severe',
    'd_anemia_moderate',
    'as_meningitis',
    'd_cellulite_erysipelas_refer',
    'd_abscess_refer',
    'd_abscess',
    'd_boils_or_small_abscess',
    'd_cellulite_erysipelas',
    'd_meningococcal_septicemia_possible',
    'd_skin_problem_no_category',
    'd_seborrhoeic_dermatitis',
    'd_ringworm_head',
    'd_kerion',
    'd_head_lice',
    'd_impetigo',
    'd_impetigo_extensive',
    'd_herpes',
    'd_body_ringworm_localised',
    'd_folliculitis',
    'd_ulcer_refer',
    'd_ulcere',
    'd_dracunculiasis',
    'd_lepre_possible',
    'd_pityriasis_versicolour',
    'd_pityriasis_alba',
    'd_molloscum_contagiosum',
    'd_zona',
    'd_meningococcal_scepticism_possible',
    'd_varicella',
    'd_varicella_superinfected',
    'd_fever_scarlet',
    'd_benign_viral_rash_possible',
    'd_urticaria',
    'd_scabies',
    'd_scabies_superinfected',
    'd_body_ringworm_extensive',
    'd_eczema_extensive',
    'd_eczema',
    'd_eczema_extensive_superinfected',
    'd_skin_problem_not_diagnosed',
    'd_vision_loss',
    'd_eye_injury',
    'd_orbital_cellulitis',
    'd_preseptal_cellulitis',
    'd_simple_headache',
    'd_serious_brain_problem',
    'd_referral_head',
    'd_migraine',
    'd_simple_head_trauma',
    'd_flu',
    'd_simple_headache_sinusitis_viral',
    'd_sinusitis_bacterial',
    'd_ear_infection_to_treat',
    'd_mastoidity',
    'd_ear_infection_w_discharge',
    'd_ear_infection_chronic',
    'd_ear_infection',
    'd_ear_wax',
    'd_ear_severe_head_trauma',
    'd_ear_foreign_obj',
    'd_ear_other',
    'd_epilepsy_known',
    'd_postictal_state',
    'd_epilepsy_likely',
    'd_convulsion_with_febrile_sickness',
    'd_first_convulsion_non_febrile',
    'd_upper_resp_infection_severe',
    'd_angina_possible',
    'd_angina_to_test',
    'd_angina',
    'd_pharyngitis_viral',
    'd_oral_candida',
    'd_eruption_tooth',
    'd_dental_cavity',
    'd_oral_ulcer',
    'd_viral_infection_oral',
    'd_gingivite',
    'd_oral_trauma',
    'd_oral_trauma_severe',
    'd_dental_abscess',
    'd_dental_abscess_possible',
    'd_mastoiditis',
    'd_foreign_body',
    'd_circumcision_infection',
    'd_hemorrhage_vaginale_observe',
    'd_possible_start_of_period',
    'as_is_vaginal_discharge',
    'd_urine_test_f',
    'd_urine_test_m',
    'as_is_red_swollen_tender_testicles',
    'as_is_bloody_urine_or_hematoria_history',
    'as_is_ulceration_or_irritation',
    'as_is_mucopurulent_discharge_m',
    'd_testicular_torsion_probably',
    'd_testicular_infection_treat',
    'd_post_circumcision_infection_probable',
    'd_balanitis',
    'd_urethritis',
    'd_lower_urinary_tract_infection',
    'as_is_suspicion_lower_urinary_tract_infection',
    'd_pyelonephritis',
    'd_urin_retention',
    'd_anuria',
    'd_anuria_referral',
    'd_trauma_genital',
    'd_diaper_rash',
    'd_bilharzia_to_test',
    'd_vesical_bilharzia',
    'd_hematuria_persistent',
    'd_kidney_problem_post_streptococcal_infection_posible',
    'd_sickle_cell_disease_possible',
    'd_hematuria_observe',
    'as_is_hiv_test_irritation_ulcerations',
    'd_herpes_genital_observe',
    'd_syphilis_and_chancre_mou',
    'd_oxyure_and_candida_likely',
    'd_candida',
    'd_genital_discharge_observe',
    'd_dehydration_severe',
    'd_dehydration',
    'd_upper_resp_infection',
    'd_herpetic_keratitis',
    'd_trachoma_possible',
    'd_cornea_abrasion_possible',
    'd_measles_past',
    'd_measles_severe_complex',
    'd_measles_complex',
    'd_measles',
    'd_measles_present_past',
    'd_measles_mouth_ulcers',
    'd_ano_rectal_cleft',
    'd_hemorrhoids',
    'd_rectal_prolapse',
    'd_stool_blood',
    'd_stool_blood_episode',
    'd_intoxication_high_risk_refer',
    'd_ingestion_non_complicated',
    'd_intoxication_substance_unknown',
    'd_intoxication_alcoholic',
    'as_substance_ingired',
    'd_selfagression_suicide_likely',
    'd_agression_suicide_unlikely',
    'd_emotional_and_substance_use_management',
    'd_agression_suicide_none',
    'dgh_antiparasites',
    'd_hypoglycemia',
    'd_hypoglycemia_none',
    'd_hypoglycemia_possible',
    'd_hiv',
    'd_hiv_none',
    'd_hiv_not_tested',
    'd_hiv_susceptible',
    'd_hiv_to_test_mother',
    'd_hiv_to_test',
    'as_danger',
    'd_fever',
    'd_illness_severe_malaria_possible',
    'd_illness_severe_no_malaria',
    'd_illness_fever_severe_malaria_possible',
    'd_illness_fever_severe_malaria_to_test',
    'd_illness_fever_severe_persistent',
    'd_illness_fever_severe_persistent_malaria_to_test',
    'd_meningitis_no_malaria',
    'd_malaria_neuro',
    'd_malaria_severe',
    'd_malaria',
    'd_malaria_possible',
    'd_meningitis_malaria_to_test',
    'd_malaria_to_test',
    'd_illness_severe_malaria_to_test',
    'd_tuberculosis_possible',
    'd_conjunctivitis_treat',
    'd_conjunctivitis_observe',
    'd_drepanocytosis',
    'd_hepatitis_possible',
    'd_hepatitis_to_test',
    'd_hepatitis',
    'd_hepatitis_persistent',
    'd_wheezing_to_follow',
    'd_wheezing_recurent',
    'd_wheezing_resistant_possible',
    'd_pneumonia_severe',
    'd_pneumonia',
    'd_abdomen_acute',
    'd_acute_intestinal_invagination',    'p_age',
    'p_weight',
    'p_weight_age',
    'p_weight_class',
    'd_convulsion',
    'd_convulsion_epi',
    'a_iv_possible',
    'a_ng_tube_possible_ds',
    'd_malnutrition_severe_complex',
    'd_malnutrition_severe_simple',
    'd_malnutrition_severe_possible',
    'd_malnutrition_moderate',
    'd_malnutrition_cannot_assess',
    'd_malnutrition_none',
    'd_malnutrition_severe',
    'd_ictere',
    'd_anemia_moderate_to_test',
    'd_anemia_severe_to_test',
    'd_anemia_severe_possible',
    'd_anemia_severe',
    'd_anemia_moderate',
    'as_meningitis',
    'd_cellulite_erysipelas_refer',
    'd_abscess_refer',
    'd_abscess',
    'd_boils_or_small_abscess',
    'd_cellulite_erysipelas',
    'd_meningococcal_septicemia_possible',
    'd_skin_problem_no_category',
    'd_seborrhoeic_dermatitis',
    'd_ringworm_head',
    'd_kerion',
    'd_head_lice',
    'd_impetigo',
    'd_impetigo_extensive',
    'd_herpes',
    'd_body_ringworm_localised',
    'd_folliculitis',
    'd_ulcer_refer',
    'd_ulcere',
    'd_dracunculiasis',
    'd_lepre_possible',
    'd_pityriasis_versicolour',
    'd_pityriasis_alba',
    'd_molloscum_contagiosum',
    'd_zona',
    'd_meningococcal_scepticism_possible',
    'd_varicella',
    'd_varicella_superinfected',
    'd_fever_scarlet',
    'd_benign_viral_rash_possible',
    'd_urticaria',
    'd_scabies',
    'd_scabies_superinfected',
    'd_body_ringworm_extensive',
    'd_eczema_extensive',
    'd_eczema',
    'd_eczema_extensive_superinfected',
    'd_skin_problem_not_diagnosed',
    'd_vision_loss',
    'd_eye_injury',
    'd_orbital_cellulitis',
    'd_preseptal_cellulitis',
    'd_simple_headache',
    'd_serious_brain_problem',
    'd_referral_head',
    'd_migraine',
    'd_simple_head_trauma',
    'd_flu',
    'd_simple_headache_sinusitis_viral',
    'd_sinusitis_bacterial',
    'd_ear_infection_to_treat',
    'd_mastoidity',
    'd_ear_infection_w_discharge',
    'd_ear_infection_chronic',
    'd_ear_infection',
    'd_ear_wax',
    'd_ear_severe_head_trauma',
    'd_ear_foreign_obj',
    'd_ear_other',
    'd_epilepsy_known',
    'd_postictal_state',
    'd_epilepsy_likely',
    'd_convulsion_with_febrile_sickness',
    'd_first_convulsion_non_febrile',
    'd_upper_resp_infection_severe',
    'd_angina_possible',
    'd_angina_to_test',
    'd_angina',
    'd_pharyngitis_viral',
    'd_oral_candida',
    'd_eruption_tooth',
    'd_dental_cavity',
    'd_oral_ulcer',
    'd_viral_infection_oral',
    'd_gingivite',
    'd_oral_trauma',
    'd_mastoiditis',
    'd_foreign_body',
    'd_circumcision_infection',
    'd_hemorrhage_vaginale_observe',
    'd_possible_start_of_period',
    'as_is_vaginal_discharge',
    'd_urine_test_f',
    'd_urine_test_m',
    'as_is_red_swollen_tender_testicles',
    'as_is_bloody_urine_or_hematoria_history',
    'as_is_ulceration_or_irritation',
    'as_is_mucopurulent_discharge_m',
    'd_testicular_torsion_probably',
    'd_testicular_infection_treat',
    'd_post_circumcision_infection_probable',
    'd_balanitis',
    'd_urethritis',
    'd_lower_urinary_tract_infection',
    'as_is_suspicion_lower_urinary_tract_infection',
    'd_pyelonephritis',
    'd_urin_retention',
    'd_anuria',
    'd_anuria_referral',
    'd_trauma_genital',
    'd_diaper_rash',
    'd_bilharzia_to_test',
    'd_vesical_bilharzia',
    'd_hematuria_persistent',
    'd_kidney_problem_post_streptococcal_infection_posible',
    'd_sickle_cell_disease_possible',
    'd_hematuria_observe',
    'as_is_hiv_test_irritation_ulcerations',
    'd_herpes_genital_observe',
    'd_syphilis_and_chancre_mou',
    'd_oxyure_and_candida_likely',
    'd_candida',
    'd_genital_discharge_observe',
    'd_dehydration_severe',
    'd_dehydration',
    'd_upper_resp_infection',
    'd_herpetic_keratitis',
    'd_trachoma_possible',
    'd_cornea_abrasion_possible',
    'd_measles_past',
    'd_measles_present_past',
    'd_measles_mouth_ulcers',
    'd_ano_rectal_cleft',
    'd_hemorrhoids',
    'd_rectal_prolapse',
    'd_stool_blood',
    'd_stool_blood_episode',
    'd_intoxication_high_risk_refer',
    'd_ingestion_non_complicated',
    'd_intoxication_substance_unknown',
    'd_intoxication_alcoholic',
    'as_substance_ingired',
    'd_selfagression_suicide_likely',
    'd_agression_suicide_unlikely',
    'd_emotional_and_substance_use_management',
    'd_agression_suicide_none',
    'dgh_antiparasites',
    'd_hypoglycemia',
    'd_hypoglycemia_none',
    'd_hypoglycemia_possible',
    'd_hiv',
    'd_hiv_possible',
    'd_hiv_none',
    'd_hiv_not_tested',
    'd_hiv_susceptible',
    'd_hiv_to_test_mother',
    'd_hiv_to_test',
    'as_danger',
    'd_fever',
    'd_illness_severe_malaria_possible',
    'd_illness_severe_no_malaria',
    'd_illness_fever_severe_malaria_possible',
    'd_illness_fever_severe_malaria_to_test',
    'd_illness_fever_severe_persistent',
    'd_illness_fever_severe_persistent_malaria_to_test',
    'd_meningitis_no_malaria',
    'd_malaria_neuro',
    'd_malaria_severe',
    'd_malaria',
    'd_malaria_possible',
    'd_meningitis_malaria_to_test',
    'd_malaria_to_test',
    'd_illness_severe_malaria_to_test',
    'd_tuberculosis_possible',
    'd_conjunctivitis_treat',
    'd_conjunctivitis_observe',
    'd_drepanocytosis',
    'd_hepatitis_possible',
    'd_hepatitis_to_test',
    'd_hepatitis',
    'd_hepatitis_persistent',
    'd_wheezing_to_follow',
    'd_wheezing_recurent',
    'd_wheezing_resistant_possible',
    'd_pneumonia_severe',
    'd_pneumonia',
    'd_abdomen_acute',
    'd_acute_intestinal_invagination',
    'd_diarrhoea_severe',
    'd_diarrhoea_cholera',
    'd_diarrhoea_severe_persistent',
    'd_diarrhoea_watery',
    'd_diarrhoea_persistent',
    'd_diarrhoea_persistent_bloody',
    'd_constipation',
    'd_intestinal_parasite',
    'd_gastroenterite_possible',
    'd_intoxication',
    'd_dysentery',
    'd_dysentery_severe',
    'd_intestinal_bilharziasis',
    'p_height',
    'dga_is_salbutamol_spray',
    'd_diarrhoea_severe',
    'd_diarrhoea_cholera',
    'd_diarrhoea_severe_persistent',
    'd_diarrhoea_watery',
    'd_diarrhoea_persistent',
    'd_diarrhoea_persistent_bloody',
    'd_constipation',
    'd_intestinal_parasite',
    'd_gastroenterite_possible',
    'd_intoxication',
    'd_dysentery',
    'd_dysentery_severe',
    'd_intestinal_bilharziasis',
    'p_height',
    'dga_is_salbutamol_sget_stylepray',
];
 
const TASK_FORM = 'pcmie_test_diag';

var generateIMCIContent =  function (content, contact, report){
    //console.log('generateIMCIContent'+ content.source_id);
    
    content.source_report_id = report._id;
    injectDataFromForm(content,'_case_',IMCI_CASE_DATA, IMCI_FORMS , [report]);
    content['patient_id'] = report.contact._id;
    content['source_form_id'] = report.id;
    console.log('end  generateIMCIContent for' + content.patient_id);
};
//TODO: redirect after task
/*function navigateToTask() {
      Router.navigate(['first'])
}*/


function getIMCIContactLabel (contact, report){
    getField(report, 'p_age') + ' months ('
+ getField(report, 'g_reg.p_weight') + 'Kg); note: ' + getField(report, 'g_pause_required.text_end');
}


function IMCIresolveIf(contact, report) {
    
    return isFormArrayHasSourceId( report, contact.reports);
}


module.exports = {
    TASK_FORM,
    IMCI_FORMS,
    generateIMCIContent,
    getIMCIContactLabel,
    IMCIresolveIf,
};


